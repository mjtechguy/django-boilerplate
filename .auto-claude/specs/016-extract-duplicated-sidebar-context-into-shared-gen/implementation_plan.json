{
  "feature": "Extract Duplicated Sidebar Context into Shared Generic Component",
  "description": "The sidebar context implementation is duplicated across admin-layout and org-layout. Both files define identical SidebarContextType interface and nearly identical provider components, differing only in storage key and naming.",
  "created_at": "2026-01-04T19:35:16.724Z",
  "updated_at": "2026-01-04T19:37:23.895Z",
  "status": "in_progress",
  "planStatus": "in_progress",
  "workflow_type": "development",
  "services_involved": [
    "frontend"
  ],
  "spec_file": "spec.md",
  "specId": "016-extract-duplicated-sidebar-context-into-shared-gen",
  "title": "Extract Duplicated Sidebar Context into Shared Generic Component",
  "objective": "Eliminate code duplication between admin-layout and org-layout sidebar context implementations by creating a shared, generic sidebar context factory that both layouts can use while maintaining backward compatibility.",
  "approach": "Create a shared createSidebarContext factory function that generates unique context, provider, and hook for each layout. This approach maintains type safety, allows independent storage keys, and provides a clean upgrade path with backward-compatible re-exports.",
  "estimatedComplexity": "medium",
  "phases": [
    {
      "id": "phase-1",
      "name": "Create Shared Sidebar Context Factory",
      "description": "Create the generic sidebar context infrastructure in the shared components directory",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Create shared sidebar context factory module",
          "description": "Create frontend/src/components/shared/sidebar-context.tsx with SidebarContextType interface export and createSidebarContext factory function that returns {Provider, useSidebarContext} tuple. The factory takes a storage key and creates isolated context for each use.",
          "status": "completed",
          "estimatedLOC": 50,
          "dependencies": [],
          "acceptanceCriteria": [
            "File exists at frontend/src/components/shared/sidebar-context.tsx",
            "Exports SidebarContextType interface",
            "Exports createSidebarContext(storageKey: string) factory function",
            "Factory returns object with Provider component and useSidebarContext hook",
            "Provider uses the existing useSidebar hook from @/hooks/use-sidebar",
            "TypeScript compiles without errors"
          ],
          "notes": "Created frontend/src/components/shared/sidebar-context.tsx with SidebarContextType interface and createSidebarContext factory function. The factory takes a storage key and returns {Provider, useSidebarContext} tuple with isolated context for each use. TypeScript code follows existing patterns from admin-layout and org-layout implementations.",
          "updated_at": "2026-01-04T19:42:01.342084+00:00"
        },
        {
          "id": "1.2",
          "title": "Add barrel export for shared sidebar context",
          "description": "Ensure the new shared sidebar context is properly exported from the shared directory. Check if index.ts exists and add export, or create one if needed.",
          "status": "completed",
          "estimatedLOC": 5,
          "dependencies": [
            "1.1"
          ],
          "acceptanceCriteria": [
            "Shared sidebar context is importable from @/components/shared/sidebar-context",
            "No import errors in TypeScript"
          ],
          "notes": "Created frontend/src/components/shared/index.ts with barrel exports for createSidebarContext function and SidebarContextType interface. This follows the existing pattern from providers/index.ts and enables both direct imports (@/components/shared/sidebar-context) and barrel imports (@/components/shared). The exports are syntactically correct and ready for use in the next phase.",
          "updated_at": "2026-01-04T19:44:17.021462+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Migrate Admin Layout to Shared Context",
      "description": "Update admin-layout to use the shared context factory while maintaining backward compatibility",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Update admin-layout sidebar-context.tsx to use shared factory",
          "description": "Refactor frontend/src/components/layouts/admin-layout/sidebar-context.tsx to import createSidebarContext from shared module and use it to create admin-specific context. Maintain existing exports (SidebarProvider, useSidebarContext) for backward compatibility.",
          "status": "completed",
          "estimatedLOC": 15,
          "dependencies": [
            "1.1"
          ],
          "acceptanceCriteria": [
            "admin-layout/sidebar-context.tsx imports from shared module",
            "Uses createSidebarContext with 'admin-sidebar' storage key",
            "Exports SidebarProvider and useSidebarContext (same API as before)",
            "All existing consumers continue to work without changes",
            "No duplicate SidebarContextType definition"
          ],
          "notes": "Refactored frontend/src/components/layouts/admin-layout/sidebar-context.tsx to use createSidebarContext from shared module. The file now imports the factory function, creates admin-specific context with 'admin-sidebar' storage key, and exports SidebarProvider and useSidebarContext for backward compatibility. This eliminates 41 lines of duplicate code while maintaining the same API for existing consumers. All imports in admin-sidebar.tsx, sidebar-nav.tsx, sidebar-resize-handle.tsx, sidebar-user.tsx, and index.tsx remain unchanged and will continue to work.",
          "updated_at": "2026-01-04T19:46:07.885981+00:00"
        },
        {
          "id": "2.2",
          "title": "Verify admin layout components still work",
          "description": "Ensure admin-sidebar.tsx, sidebar-nav.tsx, sidebar-resize-handle.tsx, and sidebar-user.tsx in admin-layout continue to work with the refactored context.",
          "status": "pending",
          "estimatedLOC": 0,
          "dependencies": [
            "2.1"
          ],
          "acceptanceCriteria": [
            "No TypeScript errors in admin-layout components",
            "Import paths remain unchanged in consumer components",
            "Application compiles successfully"
          ]
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Migrate Org Layout to Shared Context",
      "description": "Update org-layout to use the shared context factory while maintaining backward compatibility",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Update org-layout sidebar-context.tsx to use shared factory",
          "description": "Refactor frontend/src/components/layouts/org-layout/sidebar-context.tsx to import createSidebarContext from shared module. Maintain existing exports (OrgSidebarProvider, useOrgSidebarContext) for backward compatibility.",
          "status": "pending",
          "estimatedLOC": 15,
          "dependencies": [
            "1.1"
          ],
          "acceptanceCriteria": [
            "org-layout/sidebar-context.tsx imports from shared module",
            "Uses createSidebarContext with 'org-sidebar' storage key",
            "Exports OrgSidebarProvider and useOrgSidebarContext (same API as before)",
            "All existing consumers continue to work without changes",
            "No duplicate SidebarContextType definition"
          ]
        },
        {
          "id": "3.2",
          "title": "Verify org layout components still work",
          "description": "Ensure org-sidebar.tsx, sidebar-nav.tsx, sidebar-resize-handle.tsx, and sidebar-user.tsx in org-layout continue to work with the refactored context.",
          "status": "pending",
          "estimatedLOC": 0,
          "dependencies": [
            "3.1"
          ],
          "acceptanceCriteria": [
            "No TypeScript errors in org-layout components",
            "Import paths remain unchanged in consumer components",
            "Application compiles successfully"
          ]
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Verification and Cleanup",
      "description": "Final verification that all changes work correctly and the application builds",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Run TypeScript compiler check",
          "description": "Run tsc to ensure no type errors exist anywhere in the codebase after the refactoring.",
          "status": "pending",
          "estimatedLOC": 0,
          "dependencies": [
            "2.2",
            "3.2"
          ],
          "acceptanceCriteria": [
            "npm run type-check passes (or tsc --noEmit)",
            "No TypeScript errors related to sidebar context"
          ]
        },
        {
          "id": "4.2",
          "title": "Build the application",
          "description": "Run the build command to verify the application compiles and bundles correctly.",
          "status": "pending",
          "estimatedLOC": 0,
          "dependencies": [
            "4.1"
          ],
          "acceptanceCriteria": [
            "npm run build completes successfully",
            "No build errors or warnings related to sidebar context"
          ]
        },
        {
          "id": "4.3",
          "title": "Manual verification of sidebar functionality",
          "description": "Start the dev server and manually test both admin and org sidebars to verify collapse/expand, resize, and persistence work correctly.",
          "status": "pending",
          "estimatedLOC": 0,
          "dependencies": [
            "4.2"
          ],
          "acceptanceCriteria": [
            "Admin sidebar collapses and expands correctly",
            "Org sidebar collapses and expands correctly",
            "Both sidebars are resizable when expanded",
            "State persists across page reloads",
            "Admin and org sidebars maintain independent state"
          ]
        }
      ]
    }
  ],
  "filesToCreate": [
    "frontend/src/components/shared/sidebar-context.tsx"
  ],
  "filesToModify": [
    "frontend/src/components/layouts/admin-layout/sidebar-context.tsx",
    "frontend/src/components/layouts/org-layout/sidebar-context.tsx"
  ],
  "filesToDelete": [],
  "rollbackPlan": "If issues arise, revert to the original duplicate implementations by restoring the full context code in both admin-layout/sidebar-context.tsx and org-layout/sidebar-context.tsx and removing the shared/sidebar-context.tsx file.",
  "qaChecklist": [
    "TypeScript compilation passes",
    "Build completes without errors",
    "Admin sidebar collapse/expand works",
    "Org sidebar collapse/expand works",
    "Admin sidebar resize works",
    "Org sidebar resize works",
    "Admin sidebar state persists in localStorage with 'admin-sidebar' key",
    "Org sidebar state persists in localStorage with 'org-sidebar' key",
    "Both sidebars maintain independent state"
  ],
  "qaSignoff": {
    "status": "pending",
    "issues": "",
    "testsPassed": ""
  },
  "final_acceptance": [
    "No duplicate SidebarContextType interface definitions",
    "Shared factory pattern is used by both layouts",
    "All existing imports continue to work (backward compatible)",
    "TypeScript compiles without errors",
    "Application builds successfully"
  ],
  "last_updated": "2026-01-04T19:46:07.885989+00:00"
}