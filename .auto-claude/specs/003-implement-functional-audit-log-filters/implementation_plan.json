{
  "feature": "Implement Functional Audit Log Filters",
  "description": "Wire up the non-functional Filter button in the Audit Logs page to show a filter popover allowing filtering by action type, resource type, actor, and date range. The backend already supports these filters via query params; only frontend UI and state management are needed.",
  "created_at": "2026-01-04T18:24:20.885Z",
  "updated_at": "2026-01-04T18:26:02.907Z",
  "status": "in_progress",
  "planStatus": "in_progress",
  "workflow_type": "development",
  "services_involved": [
    "frontend"
  ],
  "spec_file": "spec.md",
  "phases": [
    {
      "id": "phase-1",
      "name": "UI Foundation Components",
      "description": "Create the base UI components needed for the filter functionality",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Add Radix Popover dependency",
          "description": "Install @radix-ui/react-popover package to the frontend project",
          "status": "completed",
          "files": [
            "frontend/package.json"
          ],
          "notes": "Successfully added @radix-ui/react-popover v1.1.4 to frontend/package.json dependencies",
          "updated_at": "2026-01-04T18:31:07.435466+00:00"
        },
        {
          "id": "1.2",
          "title": "Create Popover UI component",
          "description": "Create a reusable Popover component using Radix UI, following the existing shadcn/ui patterns in the codebase",
          "status": "completed",
          "files": [
            "frontend/src/components/ui/popover.tsx"
          ],
          "notes": "Successfully created popover.tsx following existing shadcn/ui patterns. Component includes Popover, PopoverTrigger, PopoverAnchor, and PopoverContent with proper styling and animations matching dialog.tsx and select.tsx patterns.",
          "updated_at": "2026-01-04T18:32:39.206907+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Filter Popover Component",
      "description": "Create the audit log filter popover component with all filter options",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Create AuditLogFilters component",
          "description": "Build a reusable filter popover component containing: action type select, resource type select, actor input field, start/end date pickers, and apply/clear buttons",
          "status": "completed",
          "files": [
            "frontend/src/routes/admin/_layout/audit/-components/audit-log-filters.tsx"
          ],
          "notes": "Successfully created AuditLogFilters component with action type select, resource type select, actor input field, start/end date pickers, and apply/clear buttons. Component follows existing UI patterns and uses shadcn/ui components.",
          "updated_at": "2026-01-04T18:34:18.780545+00:00"
        },
        {
          "id": "2.2",
          "title": "Create filter state management hook",
          "description": "Create a custom hook useAuditFilters to manage filter state with URL sync for shareable filtered views",
          "status": "completed",
          "files": [
            "frontend/src/routes/admin/_layout/audit/-hooks/use-audit-filters.ts"
          ],
          "notes": "Successfully created useAuditFilters hook with URL sync. Hook provides draftFilters/appliedFilters states, applyFilters/clearFilters/clearFilter methods, and activeFilterCount tracking. Committed as 7e9d635.",
          "updated_at": "2026-01-04T18:37:56.066213+00:00"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Admin Audit Page Integration",
      "description": "Integrate the filter popover into the admin audit logs page",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Wire up Filter button in admin audit page",
          "description": "Connect the existing Filter button to open the AuditLogFilters popover and pass filters to useAuditLogs hook",
          "status": "pending",
          "files": [
            "frontend/src/routes/admin/_layout/audit/index.tsx"
          ],
          "notes": "The useAuditLogs hook already accepts AuditFilters parameter"
        },
        {
          "id": "3.2",
          "title": "Add active filter indicators",
          "description": "Show badges or visual indicators when filters are active, and add a way to clear individual or all filters",
          "status": "pending",
          "files": [
            "frontend/src/routes/admin/_layout/audit/index.tsx"
          ],
          "notes": "Use Badge component to show active filter count"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Org Audit Page Integration",
      "description": "Update the org audit page to use the real API with filters",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Wire org audit page to API",
          "description": "Replace mock data in org audit page with actual useAuditLogs API call",
          "status": "pending",
          "files": [
            "frontend/src/routes/org/_layout/audit/index.tsx"
          ],
          "notes": "Page currently uses hardcoded mock data; needs to call the API like admin page does"
        },
        {
          "id": "4.2",
          "title": "Add filter functionality to org audit page",
          "description": "Add filter UI to org audit page, reusing the AuditLogFilters component",
          "status": "pending",
          "files": [
            "frontend/src/routes/org/_layout/audit/index.tsx",
            "frontend/src/components/shared/audit-log-filters.tsx"
          ],
          "notes": "Refactor filter component to be shared between admin and org layouts"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Testing & Polish",
      "description": "Ensure quality and proper functionality",
      "subtasks": [
        {
          "id": "5.1",
          "title": "Test filter combinations and edge cases",
          "description": "Verify all filter combinations work correctly: empty states, clearing filters, combining multiple filters",
          "status": "pending",
          "files": [],
          "notes": "Test with no results, single filters, multiple filters combined"
        },
        {
          "id": "5.2",
          "title": "Update export to respect filters",
          "description": "Ensure the Export button respects active filters when exporting audit logs",
          "status": "pending",
          "files": [
            "frontend/src/routes/admin/_layout/audit/index.tsx"
          ],
          "notes": "getAuditExportUrl already accepts filters parameter; just need to pass current filters"
        }
      ]
    }
  ],
  "critical_files": [
    {
      "path": "frontend/src/routes/admin/_layout/audit/index.tsx",
      "purpose": "Main admin audit logs page with non-functional Filter button"
    },
    {
      "path": "frontend/src/routes/org/_layout/audit/index.tsx",
      "purpose": "Org audit logs page using mock data"
    },
    {
      "path": "frontend/src/lib/api/audit/queries.ts",
      "purpose": "API hooks - useAuditLogs already accepts filters"
    },
    {
      "path": "frontend/src/lib/api/audit/types.ts",
      "purpose": "TypeScript types for AuditFilters and AuditAction"
    },
    {
      "path": "backend/api/views_audit.py",
      "purpose": "Backend API already supports all filter parameters"
    }
  ],
  "dependencies": {
    "to_install": [
      "@radix-ui/react-popover"
    ],
    "existing": [
      "@radix-ui/react-select",
      "date-fns",
      "@tanstack/react-query",
      "@tanstack/react-router"
    ]
  },
  "final_acceptance": [
    "Filter button opens popover with all filter options",
    "Action type filter works (CREATE, UPDATE, DELETE, READ, LOGIN, LOGOUT)",
    "Resource type filter works (Org, User, Team, etc.)",
    "Actor filter works with text input",
    "Date range filters work (start_date, end_date)",
    "Multiple filters can be combined",
    "Filters can be cleared individually and all at once",
    "Active filter count is displayed",
    "Export respects current filters",
    "Empty state shows when no results match filters",
    "URL updates with filter state for shareability",
    "Org audit page uses real API instead of mock data"
  ],
  "qa_signoff": {
    "status": "pending",
    "issues": "",
    "tests_passed": ""
  },
  "metadata": {
    "estimated_complexity": "medium",
    "estimated_subtasks": 10
  },
  "last_updated": "2026-01-04T18:37:56.066225+00:00"
}